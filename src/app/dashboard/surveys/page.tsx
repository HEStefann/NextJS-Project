import prisma from "@/lib/prisma";
import { url } from "inspector";
import { revalidatePath } from "next/cache";
import Link from "next/link";
import { FaTrashAlt, FaEye, FaPoll, FaShare, FaEdit } from "react-icons/fa";
import "../../../styles/globals.css";
import React, { ReactNode } from "react";

const getSurveys = async () => {
  return prisma.survey.findMany({});
};

const deleteSurvey = async (id: string) => {
  return prisma.survey.delete({
    where: { id },
  });
};

export default async function SurveysPage() {
  const surveys = await getSurveys();

  const handleDeleteSurvey = async (formData: FormData) => {
    "use server";
    const id = formData.get("id") as string;
    await deleteSurvey(id);
    revalidatePath("/dashboard/surveys");
  };

  return (
    <>
      <p className="w-[144.67px] h-[39px] mt-[40px] mb-[50px] text-[26px] text-center text-[#4e4e4e]">
        SURVEYS
      </p>
      <div className="rounded bg-[#4f35b6]/70">
        <div className="max-w-full overflow-x-auto rounded">
          <table className="w-full table-auto border border-[#4f35b6]/40 text-center">
            <thead>
              <tr className="w-[219px] h-[18px] bg-white/50 border-[#4f35b6]/40">
                <th className="min-w-[220px] py-4 px-4 font-medium text-black border border-[#4f35b6]/40">
                  Name
                </th>
                <th className="min-w-[150px] py-4 px-4 font-medium text-black border border-[#4f35b6]/40">
                  Manager
                </th>
                <th className="min-w-[120px] py-4 px-4 font-medium text-black border border-[#4f35b6]/40">
                  Status
                </th>
                <th className="py-4 px-4 font-medium text-black border border-[#4f35b6]/40">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody>
              {surveys.map((survey, index) => (
                <tr key={survey.id}>
                  <td className="border border-[#4f35b6]/40 py-5 px-4 pl-9 xl:pl-11">
                    <h5 className="font-medium text-white">
                      {survey.name}
                    </h5>
                  </td>
                  <td className="border border-[#4f35b6]/40 py-5 px-4">
                    <a
                      className="text-white"
                      href={"mailto:" + survey.manager}
                      target="_blank"
                    >
                      {survey.manager}
                    </a>
                  </td>
                  <td className="border border-[#4f35b6]/40 py-5 px-4">
                    <p
                      className={`inline-flex rounded-full bg-opacity-10 py-1 px-3 text-sm font-medium ${survey.status === "ONGOING"
                        ? "text-white"
                        : survey.status === "FINISHED"
                          ? "text-white"
                          : "text-white"
                        }`}
                    >
                      {survey.status}
                    </p>
                  </td>
                  <td className="border-t border-r-0 border-b-0 border-l border-[#4f35b6]/40 py-5 px-4">
                    <div className="flex items-center space-x-3.5 text-white">
                      <  Link
                        href={"/dashboard/surveys/" + survey.id + "/edit"}
                        className="hover:text-[#4f35b6]"
                      >
                        <FaEdit />
                      </Link>
                      <  Link
                        href={"/dashboard/surveys/" + survey.id}
                        className="hover:text-[#4f35b6]"
                      >
                        <FaEye />
                      </Link>
                      <Link
                        href={"/dashboard/reports/" + survey.id}
                        className="hover:text-[#4f35b6]"
                      >
                        <FaPoll />
                      </Link>
                      <Link
                        href={"/dashboard/surveys/" + survey.id + "/share"}
                        className="hover:text-[#4f35b6]"
                      >
                        <FaShare />
                      </Link>
                      <form action={handleDeleteSurvey} className="flex">
                        <input type="hidden" name="id" value={survey.id} />
                        <button type="submit" className="hover:text-[#4f35b6]">
                          <FaTrashAlt />
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
      <Link href="/dashboard/surveys/create">
        <div
          className="mb-5 mt-5 flex justify-center items-center gap-2.5 px-2.5 py-[9px] rounded bg-[#4f35b6]/[0.66]"
          style={{ boxShadow: "0px 2px 12px 0 rgba(32,32,32,0.18)" }}
        >
          <svg
            width={30}
            height={31}
            viewBox="0 0 30 31"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            className="flex-grow-0 flex-shrink-0 w-[30px] h-[31px] relative"
            preserveAspectRatio="none"
          >
            <path
              d="M27.3111 9.02397C27.2927 9.01417 27.2736 9.00527 27.2538 8.99815C25.974 8.53269 24.5662 9.23054 24.1142 10.5528L23.4089 12.6626V7.28058C23.4089 5.76245 22.2133 4.52703 20.7442 4.52703H17.6383V4.38568C17.6383 3.7929 17.1795 3.32344 16.6148 3.32344H15.3442C15.3177 1.58205 13.9456 0.173218 12.2603 0.173218C10.5707 0.173218 9.19858 1.58205 9.18092 3.32344H7.90597C7.33683 3.32344 6.87799 3.7929 6.87799 4.38568V4.52703H3.77651C2.30299 4.52703 1.10742 5.76245 1.10742 7.28058V28.0733C1.10742 29.5914 2.30299 30.8269 3.77651 30.8269H20.7442C22.2133 30.8269 23.4089 29.5914 23.4089 28.0733V26.7404L23.6414 26.5416C23.9572 26.2723 24.1907 25.917 24.3133 25.523C24.767 24.1655 22.6696 30.4405 28.7509 12.247C29.2017 10.9369 28.5534 9.51062 27.3111 9.02397ZM12.2603 1.80086C12.856 1.80086 13.3412 2.30238 13.3412 2.92231C13.3412 3.5378 12.856 4.03464 12.2603 4.03464C11.6604 4.03464 11.175 3.5378 11.175 2.92231C11.175 2.30238 11.6604 1.80086 12.2603 1.80086ZM24.5141 12.117L25.5893 12.5099L21.7207 24.095L20.6492 23.703L24.5141 12.117ZM23.6245 24.7913L22.5525 24.3993L26.4213 12.8137L27.4966 13.2064L23.6245 24.7913ZM22.5265 28.0733C22.5265 29.0899 21.728 29.9151 20.7442 29.9151H3.77651C2.79269 29.9151 1.98977 29.0899 1.98977 28.0733V7.28058C1.98977 6.26397 2.79269 5.43879 3.77651 5.43879H6.87799V5.70769C6.87799 6.30025 7.33683 6.77439 7.90597 6.77439H16.6148C17.1795 6.77439 17.6383 6.30025 17.6383 5.70769V5.43879H20.7442C21.728 5.43879 22.5265 6.26397 22.5265 7.28058V15.3019C21.7513 17.6168 20.0606 22.6886 19.66 23.8613C19.5261 24.25 19.4989 24.6682 19.5806 25.068L20.2647 28.5557C20.2953 28.7128 20.4037 28.8419 20.5499 28.8954C20.6986 28.9491 20.8602 28.918 20.9784 28.8168L22.5265 27.4941V28.0733Z"
              fill="white"
            />
            <path
              d="M5.75713 10.4272C5.46093 10.4272 5.17916 10.3666 4.9198 10.2471C4.82114 10.2015 4.7033 10.2215 4.63157 10.3019C4.58655 10.3524 4.56371 10.4129 4.56371 10.4817C4.56371 10.5354 4.57944 10.5857 4.61046 10.6315C4.64083 10.6769 4.68004 10.7103 4.72679 10.7304C5.05788 10.8786 5.41785 10.9534 5.79677 10.9534C6.02683 10.9534 6.23342 10.9136 6.41092 10.8345C6.5908 10.7544 6.73297 10.6409 6.83293 10.4966C6.93439 10.3511 6.98588 10.1845 6.98588 10.0011C6.98588 9.77986 6.92965 9.6 6.8185 9.46689C6.71079 9.33801 6.5796 9.24162 6.42837 9.18063C6.28469 9.12231 6.09361 9.06354 5.85988 9.00522C5.6841 8.96359 5.54408 8.92397 5.44348 8.88724C5.34934 8.85296 5.27029 8.80488 5.20846 8.74389C5.15288 8.68868 5.12574 8.61812 5.12574 8.52797C5.12574 8.38907 5.18627 8.28356 5.311 8.20565C5.44456 8.12195 5.62271 8.07965 5.8405 8.07965C6.07487 8.07965 6.30515 8.1195 6.5223 8.19696C6.55978 8.21255 6.5908 8.21989 6.61708 8.21989C6.68881 8.21989 6.75021 8.1914 6.79458 8.13708C6.83702 8.08544 6.85856 8.02623 6.85856 7.96123C6.85856 7.84259 6.79932 7.75533 6.69269 7.71593C6.42622 7.61376 6.12485 7.56189 5.79677 7.56189C5.54839 7.56189 5.33168 7.60596 5.15202 7.69322C4.97021 7.78159 4.8304 7.90291 4.73648 8.05339C4.64213 8.20476 4.5943 8.37504 4.5943 8.55958C4.5943 8.77283 4.65333 8.9469 4.76965 9.07756C4.88146 9.20244 5.01652 9.29749 5.17162 9.36004C5.3194 9.4197 5.51522 9.48203 5.75347 9.54614C5.93033 9.59422 6.06755 9.63562 6.16104 9.66901C6.24915 9.70106 6.32346 9.74447 6.38227 9.79856C6.43376 9.84575 6.45875 9.90318 6.45875 9.97397C6.45875 10.0862 6.45875 10.4272 5.75713 10.4272ZM9.27146 8.51506C9.21869 8.56759 9.19197 8.63304 9.19197 8.70916V10.0452C9.0987 10.1632 8.99874 10.2587 8.89491 10.3295C8.78936 10.4011 8.67282 10.4361 8.53861 10.4361C8.25447 10.4361 8.12221 10.282 8.12221 9.95127V8.70916C8.12221 8.63326 8.09657 8.56804 8.04595 8.51595C7.9447 8.41155 7.77452 8.4111 7.67026 8.51506C7.61748 8.56759 7.59077 8.63304 7.59077 8.70916V9.99668C7.59077 10.1694 7.62459 10.3304 7.69159 10.475C7.75966 10.6222 7.85918 10.7397 7.98735 10.8247C8.11617 10.9102 8.26912 10.9534 8.4421 10.9534C8.62822 10.9534 8.7928 10.9124 8.9311 10.8314C9.02179 10.7782 9.10904 10.7121 9.19197 10.6338V10.654C9.19197 10.7299 9.21825 10.7958 9.2706 10.8497C9.37508 10.9579 9.54612 10.9579 9.64823 10.8488C9.69821 10.7949 9.72341 10.7295 9.72341 10.654V8.70916C9.72341 8.63348 9.69777 8.56848 9.64715 8.51595C9.54591 8.41133 9.37572 8.4111 9.27146 8.51506ZM10.8111 10.9309C10.8841 10.9309 10.9476 10.9047 10.9995 10.8528C11.0523 10.8005 11.079 10.735 11.079 10.6587V9.30128C11.1503 9.19443 11.2382 9.10895 11.3403 9.04707C11.4463 8.98252 11.565 8.95002 11.693 8.95002H11.7147C11.7903 8.95002 11.8541 8.92553 11.9043 8.87745C11.9564 8.82803 11.9827 8.7637 11.9827 8.68646C11.9827 8.61122 11.9582 8.54667 11.9095 8.49413C11.8601 8.44115 11.7977 8.41444 11.7236 8.41444H11.7016C11.4754 8.41444 11.2667 8.51728 11.079 8.72074V8.71384C11.079 8.63793 11.0525 8.57204 11.0006 8.51817C10.8961 8.40999 10.7238 8.41044 10.6232 8.51906C10.573 8.57293 10.5476 8.63838 10.5476 8.71384V10.6587C10.5476 10.7348 10.5732 10.7998 10.6241 10.8521C10.6747 10.9044 10.7376 10.9309 10.8111 10.9309ZM13.0495 10.7223C13.0747 10.7822 13.115 10.8323 13.1686 10.871C13.2235 10.9107 13.2849 10.9309 13.3513 10.9309H13.3952C13.4613 10.9309 13.5227 10.9107 13.5779 10.871C13.6313 10.8323 13.6714 10.7822 13.6974 10.7212L14.4609 8.83538C14.479 8.79019 14.4878 8.75057 14.4878 8.71384C14.4878 8.6386 14.4624 8.57316 14.4124 8.51906C14.3271 8.42691 14.1884 8.4091 14.0809 8.48189C14.0365 8.5115 14.004 8.54978 13.9829 8.59809L13.3732 10.1957L12.7621 8.59475C12.7423 8.54956 12.7098 8.5115 12.6658 8.48211C12.5575 8.40866 12.4202 8.42691 12.3338 8.51906C12.2839 8.57316 12.2585 8.6386 12.2585 8.71384C12.2585 8.75057 12.2673 8.79019 12.2856 8.83538L13.0495 10.7223ZM16.1151 10.9534C16.296 10.9534 16.447 10.936 16.5634 10.9009C16.6786 10.8666 16.7971 10.8141 16.9158 10.7451C17.0375 10.6725 17.0629 10.5817 17.0629 10.518C17.0629 10.4479 17.0373 10.3867 16.989 10.3408C16.9121 10.2678 16.798 10.2544 16.7129 10.2981C16.6299 10.341 16.5435 10.3744 16.4563 10.3974C16.3701 10.4201 16.2672 10.4316 16.1502 10.4316C15.9367 10.4316 15.77 10.3778 15.6545 10.2718C15.5531 10.1792 15.4889 10.0561 15.4593 9.8974H16.8697C16.9494 9.8974 17.0149 9.87046 17.0642 9.81748C17.1129 9.76517 17.1377 9.7004 17.1377 9.62494C17.1377 9.41035 17.0942 9.2089 17.008 9.02614C16.9212 8.84161 16.7919 8.6918 16.6243 8.58139C16.4565 8.47054 16.2555 8.41444 16.0274 8.41444C15.7838 8.41444 15.5748 8.47477 15.4064 8.59386C15.2388 8.71273 15.113 8.87033 15.0322 9.06287C14.9529 9.25186 14.9128 9.46088 14.9128 9.68392C14.9128 10.0817 15.0203 10.396 15.2323 10.6182C15.4445 10.8408 15.7413 10.9534 16.1151 10.9534ZM15.4555 9.42504C15.4697 9.32131 15.5003 9.23227 15.5472 9.1597C15.6052 9.06977 15.6754 9.00567 15.7616 8.96382C15.9354 8.87923 16.1187 8.87923 16.293 8.96382C16.3783 9.00522 16.4514 9.07133 16.5099 9.16015C16.5578 9.23272 16.5892 9.32176 16.6034 9.42504H15.4555ZM18.3774 10.8768L18.1017 11.6092C18.09 11.6408 18.0842 11.6733 18.0842 11.7058C18.0842 11.7784 18.1088 11.8416 18.1575 11.8937C18.2068 11.9466 18.2678 11.9734 18.3388 11.9734C18.4142 11.9734 18.5179 11.9422 18.5844 11.7908L19.7826 8.81512C19.7942 8.78351 19.8 8.74923 19.8 8.71384C19.8 8.63838 19.7748 8.57293 19.7246 8.51906C19.6738 8.46453 19.6105 8.43693 19.5366 8.43693C19.4586 8.43693 19.353 8.46764 19.2912 8.61523L18.6643 10.1828L18.0491 8.60588C18.0295 8.5578 17.9974 8.51728 17.9532 8.48545C17.8477 8.40955 17.7042 8.42424 17.6155 8.51906C17.5655 8.57316 17.5401 8.6386 17.5401 8.71384C17.5401 8.74923 17.5476 8.78685 17.5627 8.82581L18.3774 10.8768ZM7.12267 25.3489H4.54476C4.20224 25.3489 3.92371 25.6365 3.92371 25.9904V28.077C3.92371 28.431 4.20224 28.7188 4.54476 28.7188H7.12267C7.46518 28.7188 7.74372 28.431 7.74372 28.077V25.9904C7.74372 25.6365 7.46518 25.3489 7.12267 25.3489ZM10.4625 13.2958H20.6371C20.8442 13.2958 21.0122 13.1224 21.0122 12.9083C21.0122 12.6941 20.8442 12.5207 20.6371 12.5207H10.4625C10.2555 12.5207 10.0875 12.6941 10.0875 12.9083C10.0875 13.1224 10.2555 13.2958 10.4625 13.2958ZM10.4625 15.0624H16.832C17.039 15.0624 17.207 14.889 17.207 14.6748C17.207 14.4607 17.039 14.2873 16.832 14.2873H10.4625C10.2555 14.2873 10.0875 14.4607 10.0875 14.6748C10.0875 14.889 10.2555 15.0624 10.4625 15.0624ZM10.4625 17.8473H20.6371C20.8442 17.8473 21.0122 17.6739 21.0122 17.46C21.0122 17.2458 20.8442 17.0722 20.6371 17.0722H10.4625C10.2555 17.0722 10.0875 17.2458 10.0875 17.46C10.0875 17.6739 10.2555 17.8473 10.4625 17.8473ZM10.4625 19.6138H16.832C17.039 19.6138 17.207 19.4404 17.207 19.2265C17.207 19.0124 17.039 18.8387 16.832 18.8387H10.4625C10.2555 18.8387 10.0875 19.0124 10.0875 19.2265C10.0875 19.4404 10.2555 19.6138 10.4625 19.6138ZM18.7346 21.4178H10.4625C10.2555 21.4178 10.0875 21.5912 10.0875 21.8051C10.0875 22.0192 10.2555 22.1929 10.4625 22.1929H18.7346C18.9416 22.1929 19.1096 22.0192 19.1096 21.8051C19.1096 21.5912 18.9416 21.4178 18.7346 21.4178ZM10.4625 23.9594H14.9294C15.1364 23.9594 15.3045 23.7858 15.3045 23.5716C15.3045 23.3577 15.1364 23.1843 14.9294 23.1843H10.4625C10.2555 23.1843 10.0875 23.3577 10.0875 23.5716C10.0875 23.7858 10.2555 23.9594 10.4625 23.9594ZM18.7346 25.7629H10.4625C10.2555 25.7629 10.0875 25.9365 10.0875 26.1504C10.0875 26.3644 10.2555 26.538 10.4625 26.538H18.7346C18.9416 26.538 19.1096 26.3644 19.1096 26.1504C19.1096 25.9365 18.9416 25.7629 18.7346 25.7629ZM14.9294 27.5294H10.4625C10.2555 27.5294 10.0875 27.7031 10.0875 27.917C10.0875 28.1309 10.2555 28.3045 10.4625 28.3045H14.9294C15.1364 28.3045 15.3045 28.1309 15.3045 27.917C15.3045 27.7031 15.1364 27.5294 14.9294 27.5294ZM4.5439 24.3714H7.12482C7.46453 24.3714 7.74242 24.0843 7.74242 23.7332V21.6453C7.74242 21.2898 7.46453 21.0024 7.12482 21.0024H4.5439C4.20423 21.0024 3.92188 21.2898 3.92188 21.6453V23.7332C3.92187 24.0843 4.20423 24.3714 4.5439 24.3714ZM4.99326 22.4644C5.12251 22.3309 5.33189 22.3309 5.46115 22.4644L5.62012 22.6287L6.20649 22.0228C6.33574 21.8892 6.54513 21.8892 6.67438 22.0228C6.80363 22.1564 6.80363 22.3729 6.67438 22.5063L5.85407 23.3539C5.72482 23.4875 5.51543 23.4875 5.38618 23.3539L4.99326 22.9479C4.86401 22.8146 4.86401 22.598 4.99326 22.4644ZM4.5439 20.027H7.12482C7.46453 20.027 7.74242 19.7398 7.74242 19.3886V17.3008C7.74242 16.9451 7.46453 16.6579 7.12482 16.6579H4.5439C4.20423 16.6579 3.92188 16.9451 3.92188 17.3008V19.3886C3.92187 19.7398 4.20423 20.027 4.5439 20.027ZM4.99326 18.1193C5.12251 17.9857 5.33189 17.9857 5.46115 18.1193L5.62012 18.2836L6.20649 17.6777C6.33574 17.5441 6.54513 17.5441 6.67438 17.6777C6.80363 17.811 6.80363 18.0276 6.67438 18.1612L5.85407 19.0088C5.72482 19.1424 5.51543 19.1424 5.38618 19.0088L4.99326 18.6028C4.86401 18.4692 4.86401 18.2526 4.99326 18.1193ZM4.5439 15.6823H7.12482C7.46453 15.6823 7.74242 15.3951 7.74242 15.0397V12.9561C7.74242 12.6006 7.46453 12.3135 7.12482 12.3135H4.5439C4.20423 12.3135 3.92188 12.6006 3.92188 12.9561V15.0397C3.92187 15.3951 4.20423 15.6823 4.5439 15.6823ZM4.99326 13.7737C5.12251 13.6402 5.33189 13.6402 5.46115 13.7737L5.62012 13.938L6.20649 13.3321C6.33574 13.1985 6.54513 13.1985 6.67438 13.3321C6.80363 13.4657 6.80363 13.6822 6.67438 13.8156L5.85407 14.6632C5.72482 14.7968 5.51543 14.7968 5.38618 14.6632L4.99326 14.2572C4.86401 14.1239 4.86401 13.9073 4.99326 13.7737Z"
              fill="white"
            />
          </svg>
          <p className="flex-grow-0 flex-shrink-0 text-[17px] text-center text-white">Create survey</p>
        </div>
      </Link>
    </>
  );
}
